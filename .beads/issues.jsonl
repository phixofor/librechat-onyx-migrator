{"id":"librechat-migrator-1xq","title":"Purge Philip’s Onyx sessions except preserved baseline","description":"Remove every chat_session belonging to philip.lilius@friendsagenda.se except dcf89e65-f948-47f9-a0e1-eda596a51384 so we can re-import cleanly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T14:39:47.58894+01:00","updated_at":"2025-12-10T14:40:33.068921+01:00","closed_at":"2025-12-10T14:40:33.068921+01:00"}
{"id":"librechat-migrator-270","title":"Fix imported attachments so Onyx can download them","description":"Imported messages reference attachments, but clicking them in the Onyx UI returns a 404. Investigation findings (Dec 3, 2025):\n- `chat_message.files` entries point at `user_file.id` values (e.g., `229a4849-1c19-42e1-9515-12402c5c8590`).\n- Those rows exist in `user_file`, but hitting `/api/files/\u003cuser_file_id\u003e` returns `{\"detail\":\"404: Not Found\"}`.\n- S3 bucket `onyx-file-store-bucket` only contains keys like `onyx-files/public/\u003cuuid\u003e`, whereas our importer uploads to `user-files/\u003clibrechat_file_id\u003e` (default `S3_FILE_PREFIX`). Head-object for `user-files/...` fails with 404, so the binaries never landed where Onyx expects them.\n- Result: UI can't load the attachment binaries, even though metadata exists in Postgres.\n\nWork needed:\n1. Align the importer’s upload key with Onyx’s convention (likely `onyx-files/public/\u003cuser_file_id\u003e` or whatever backend uses when generating signed URLs).\n2. Re-upload/copy existing attachments (or re-import with the corrected prefix) so previously imported chats regain working file links.\n3. Ensure `lc-mig.py import-chats --copy-files` errors loudly when a referenced file can’t be found, so we know which binaries remain missing.\n\nAcceptance criteria:\n- New imports upload files to the correct S3 key so `/api/files/\u003cuser_file_id\u003e` returns 200.\n- Provide a repair path (script or documented steps) to migrate existing uploaded files to the correct location or re-import affected sessions.\n- Add validation or logging in the importer to surface attachment upload failures immediately.","notes":"Fixed file download failures by normalizing legacy file_record.file_origin values to uppercase enum names: ran UPDATE to replace chat_upload/chat_image_gen/connector/user_file with their uppercase equivalents, aligning with backend’s Enum definition. Attachment downloads now succeed post-reimport.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-05T14:06:55.41483+01:00","updated_at":"2025-12-10T14:51:22.160722+01:00","closed_at":"2025-12-10T14:51:22.160722+01:00"}
{"id":"librechat-migrator-2bv","title":"Simplify file payload type and document requirements/compatibility","description":"PR review https://github.com/phixofor/librechat-onyx-migrator/pull/1#pullrequestreview-3613799889 suggests removing redundant file type derivation in `_import_chat_message`: `get_or_upload_file` already provides `uploaded[\"chat_file_type\"]`.\n\nAlso update README.md to clarify:\n- Full pipeline requires access to LibreChat MongoDB and Onyx (Postgres + API).\n- Compatibility tested only with Onyx 2.5.x and LibreChat 0.8.1.\n\nAcceptance:\n- `_import_chat_message` uses `uploaded[\"chat_file_type\"]` directly.\n- README updated with prerequisites + tested versions.\n- `python -m py_compile lc-mig.py` passes.\n- Changes pushed to PR and review comment replied.","status":"in_progress","priority":2,"issue_type":"task","assignee":"codex","created_at":"2025-12-26T21:12:11.431873+01:00","updated_at":"2025-12-26T21:12:16.404901+01:00","dependencies":[{"issue_id":"librechat-migrator-2bv","depends_on_id":"librechat-migrator-y94","type":"discovered-from","created_at":"2025-12-26T21:12:11.433714+01:00","created_by":"daemon"}]}
{"id":"librechat-migrator-9fi","title":"Refactor per-message import logic into helper","description":"PR review https://github.com/phixofor/librechat-onyx-migrator/pull/1#pullrequestreview-3613365868 suggests extracting the large per-message import block inside `import_chats` into a helper for readability/maintainability.\n\nChange:\n- Extract the body of the `for message in variant_messages:` loop into a helper (preferably private) that returns updated `previous_id` and mutates `message_id_map`.\n- Keep behavior identical: all messages are inserted, parent links preserved, attachments uploaded/mapped, and commit remains once per branch.\n\nAcceptance:\n- No functional change vs current PR behavior.\n- `python -m py_compile lc-mig.py` passes.\n- PR updated and reviewer thread replied.","status":"closed","priority":3,"issue_type":"task","assignee":"codex","created_at":"2025-12-26T14:27:04.385729+01:00","updated_at":"2025-12-26T14:28:22.219426+01:00","closed_at":"2025-12-26T14:28:22.219426+01:00","dependencies":[{"issue_id":"librechat-migrator-9fi","depends_on_id":"librechat-migrator-y94","type":"discovered-from","created_at":"2025-12-26T14:27:04.387373+01:00","created_by":"daemon"}]}
{"id":"librechat-migrator-9nx","title":"Implement Onyx import pipeline for exported LibreChat chats","description":"Build tooling that ingests the JSONL bundles produced by export-chats, creates chat sessions/messages in Onyx Postgres, uploads attachments to MinIO, and records metadata per the plan.","notes":"LibreChat “think” segments now render as standard Markdown blockquotes (`\u003e **Thinking** …`) so they wrap naturally without modifying the frontend. Re-imported Philip’s bundle again after clearing his sessions; verified 163 assistant messages contain the new blockquote format and no Markdown fences remain.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-02T16:37:07.745627+01:00","updated_at":"2025-12-10T14:51:29.38169+01:00","closed_at":"2025-12-10T14:51:29.38169+01:00","dependencies":[{"issue_id":"librechat-migrator-9nx","depends_on_id":"librechat-migrator-uni","type":"blocks","created_at":"2025-12-02T16:37:12.181531+01:00","created_by":"daemon"}]}
{"id":"librechat-migrator-g1j","title":"Do not track .beads metadata/config files in git status","description":"PR review notes `.gitignore` changes around `.beads`. Currently `.beads/metadata.json` shows up as an untracked file because `.beads/.gitignore` un-ignores it.\n\nChange: ensure only `.beads/issues.jsonl` is tracked/unignored; suppress `.beads/metadata.json` and other daemon/db artifacts from git status.\n\nAcceptance:\n- `git status --porcelain` is clean w.r.t `.beads/metadata.json` after bd operations.\n- `.beads/issues.jsonl` remains tracked/committed.","status":"closed","priority":2,"issue_type":"task","assignee":"codex","created_at":"2025-12-26T11:48:08.100551+01:00","updated_at":"2025-12-26T11:49:00.498787+01:00","closed_at":"2025-12-26T11:49:00.498787+01:00","dependencies":[{"issue_id":"librechat-migrator-g1j","depends_on_id":"librechat-migrator-y94","type":"discovered-from","created_at":"2025-12-26T11:48:08.102184+01:00","created_by":"daemon"}]}
{"id":"librechat-migrator-ong","title":"Batch import-chats commits per session branch","description":"PR review https://github.com/phixofor/librechat-onyx-migrator/pull/1#discussion_r2647951657 notes that `import-chats` currently calls `conn.commit()` for every message, which can severely slow imports for long conversations.\n\nChange: remove per-message commits and commit once after processing all `variant_messages` for a chat session branch (still within the per-branch loop), keeping inserts in a single transaction per imported branch.\n\nAcceptance:\n- `conn.commit()` is executed once per imported chat session branch, not once per message.\n- `python -m py_compile lc-mig.py` passes.\n- PR updated with new commit and review thread responded to.","status":"closed","priority":1,"issue_type":"task","assignee":"codex","created_at":"2025-12-26T11:26:35.302684+01:00","updated_at":"2025-12-26T11:27:37.528472+01:00","closed_at":"2025-12-26T11:27:37.528472+01:00","dependencies":[{"issue_id":"librechat-migrator-ong","depends_on_id":"librechat-migrator-y94","type":"discovered-from","created_at":"2025-12-26T11:26:35.304319+01:00","created_by":"daemon"}]}
{"id":"librechat-migrator-ovm","title":"Add attachment upload + Postgres connectivity instructions to import pipeline","description":"Extend the import tooling so attachments from export bundles are uploaded into MinIO/S3 and linked via user_file/chat_message files JSON, and document how to connect to Postgres for running imports.","notes":"Updated .env with explicit POSTGRES_* and S3_* defaults (pointing at host.docker.internal) so the importer picks up external connection details automatically. Reminder: lc-mig.py calls load_env('.env'), so any overrides placed there are honored without touching the CLI flags.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-03T09:20:10.222661+01:00","updated_at":"2025-12-03T11:56:28.514483+01:00","closed_at":"2025-12-03T11:56:28.514483+01:00"}
{"id":"librechat-migrator-q7i","title":"Support importing branched LibreChat conversations","description":"Currently lc-mig.py skips any LibreChat conversation that contains branching, because Onyx chat sessions are linear. Add a flag (e.g., --split-branches) so each branch is imported as its own session with a suffix like \"(branch #N)\", preserving all messages without corrupting the main thread","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-16T14:44:49.763863+01:00","updated_at":"2025-12-16T15:01:04.411837+01:00","closed_at":"2025-12-16T15:01:04.411837+01:00"}
{"id":"librechat-migrator-q8m","title":"Purge all Onyx sessions except Philip’s preserved chat","description":"Delete chat_session rows for all users except philip.lilius@friendsagenda.se (keeping session dcf89e65-f948-47f9-a0e1-eda596a51384) so we can re-import cleanly for deployment.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T13:45:33.276468+01:00","updated_at":"2025-12-19T13:48:59.494969+01:00","closed_at":"2025-12-19T13:48:59.494969+01:00"}
{"id":"librechat-migrator-qaz","title":"Add per-branch transaction rollback in import-chats","description":"PR review https://github.com/phixofor/librechat-onyx-migrator/pull/1#pullrequestreview-3613625352 flags critical transaction robustness: if any INSERT fails during a session-branch import, the connection is left in an error state and can lead to partial/inconsistent imports.\n\nFix: wrap each imported chat-session branch's DB writes in try/except; on exception, call `conn.rollback()`, log the failure, and continue to next branch/conversation. Ensure counters don't claim messages were imported if the transaction was rolled back.\n\nAcceptance:\n- A failure during one branch import triggers `rollback()` and does not prevent subsequent branches.\n- `stats[\"imported\"]` only counts committed messages.\n- `python -m py_compile lc-mig.py` passes.\n- PR updated and review thread replied.","status":"closed","priority":1,"issue_type":"bug","assignee":"codex","created_at":"2025-12-26T17:03:27.825372+01:00","updated_at":"2025-12-26T17:06:42.975447+01:00","closed_at":"2025-12-26T17:06:42.975447+01:00","dependencies":[{"issue_id":"librechat-migrator-qaz","depends_on_id":"librechat-migrator-y94","type":"discovered-from","created_at":"2025-12-26T17:03:27.827586+01:00","created_by":"daemon"}]}
{"id":"librechat-migrator-r7m","title":"Purge imported chat history except specific session","description":"Remove all chats imported into Onyx for the affected user except chat_session dcf89e65-f948-47f9-a0e1-eda596a51384, so we can re-import fresh once content handling is fixed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-03T11:40:27.373443+01:00","updated_at":"2025-12-03T11:56:35.270381+01:00","closed_at":"2025-12-03T11:56:35.270381+01:00"}
{"id":"librechat-migrator-uni","title":"Investigate chat history migration path from LibreChat MongoDB to Onyx Postgres","description":"Need to understand how chat histories are stored in LibreChat's MongoDB deployment and how Onyx stores conversations in Postgres so we can plan per-user chat migration.","notes":"Implementation update (2025-12-02): added JSONL export tooling + docs.\n- `lc-mig.py` now has an `export-chats` subcommand that reads LibreChat Mongo conversations/messages for specific user emails, normalizes metadata, detects branching, and writes per-user bundles under `exports/export_\u003ctimestamp\u003e/\u003cemail-slug\u003e/`.\n- Bundles include `summary.json`, `conversations.jsonl`, `files_manifest.jsonl`, and optional copied binaries (`--copy-files`). Each conversation record tracks message order, branch hints, referenced/missing file_ids, and attachments metadata (sha256 + source path) ready for later ingestion + JSONB storage in Onyx (`prompt_override.librechat`, etc.).\n- Asset lookup searches default roots (`../LibreChat/uploads`, `../LibreChat/images`, `../LibreChat`) and can be extended via `LIBRECHAT_ASSET_ROOTS` or `--asset-root`. Script never touches LibreChat prod data except for reads/copies.\n- Added repo README with usage instructions, metadata strategy, and safety guidance; added `.gitignore` to keep export artifacts out of git.\nOutstanding: need network access from host to Mongo (currently only reachable via docker exec) before running full exports; once reachable, run pilot for philip.lilius@friendsagenda.se and validate counts before proceeding.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-02T10:48:59.619197+01:00","updated_at":"2025-12-10T14:51:40.036476+01:00","closed_at":"2025-12-10T14:51:40.036476+01:00"}
{"id":"librechat-migrator-y94","title":"Importer inserts only last LibreChat message per conversation","description":"`import-chats` only inserts a single chat_message per conversation because the bulk of the per-message processing (parent resolution, file handling, INSERT, latest_child updates) is outdented from the `for message in variant_messages` loop. The loop currently only sets variables from the last message, then the INSERT runs once using that last record. Result: imported sessions contain the system intro plus a single LibreChat message; all preceding messages are dropped, breaking history, parent pointers, and attachments.\n\nFix: move the parent_id resolution, metadata construction, file upload mapping, and INSERT block back inside the loop so every LibreChat message is persisted in order with correct parent/child links.","status":"closed","priority":0,"issue_type":"bug","assignee":"codex","created_at":"2025-12-26T10:54:31.559874+01:00","updated_at":"2025-12-26T11:02:32.343931+01:00","closed_at":"2025-12-26T11:02:32.343931+01:00"}
{"id":"librechat-migrator-zkj","title":"Address PR review 3613494724 clarity suggestions","description":"PR review https://github.com/phixofor/librechat-onyx-migrator/pull/1#pullrequestreview-3613494724 suggests:\n1) Replace magic null UUID string with a module-level constant.\n2) Reuse/consolidate `_extract_message_file_ids` so import/export use consistent file-id extraction.\n3) Consider redundancy of `id` vs `user_file_id` in `chat_message.files` payload.\n\nPlan:\n- Implement (1) and (2) as safe refactors.\n- For (3), keep current payload keys unless we can confirm schema expectations; reply on thread accordingly.\n\nAcceptance:\n- `python -m py_compile lc-mig.py` passes.\n- PR updated and replies posted on relevant threads.","status":"closed","priority":3,"issue_type":"task","assignee":"codex","created_at":"2025-12-26T16:16:23.997251+01:00","updated_at":"2025-12-26T16:17:07.905662+01:00","closed_at":"2025-12-26T16:17:07.905662+01:00","dependencies":[{"issue_id":"librechat-migrator-zkj","depends_on_id":"librechat-migrator-y94","type":"discovered-from","created_at":"2025-12-26T16:16:23.999413+01:00","created_by":"daemon"}]}
